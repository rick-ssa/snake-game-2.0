name: deploy
on: 
    push:
        branches:
            -   desenvolvimento

    pull_request: 
        branches:
            -   desenvolvimento

jobs:
    deploy-dev:
        runs-on: ubuntu-latest

        steps:
            -   name: checkout code
                uses: actions/checkout@v4

            -   name: setup node v20
                uses: actions/setup-node@v3
                with:
                    node-version: '20'
                    
            -   name: install node dependencies
                run: npm install
            
            -   name: testing
                run:  npm test

    # Build job
    build:
        runs-on: ubuntu-latest

        steps:
        -   name: Checkout
            uses: actions/checkout@v4

        -   name: Setup Pages
            id: pages
            uses: actions/configure-pages@v3

        -   name: Build with Jekyll
            uses: actions/jekyll-build-pages@v1
            with:
                source: ./
                destination: ./_site

        -   name: Upload artifact
            uses: actions/upload-pages-artifact@v2

    # Deployment job
    deploy:
        permissions:
            contents: read
            pages: write
            id-token: write
            
        environment:
            name: github-pages
            url: ${{steps.deployment.outputs.page_url}}

        runs-on: ubuntu-latest

        needs: build

        steps:
            -   name: Deploy to GitHub Pages
                id: deployment
                uses: actions/deploy-pages@v2